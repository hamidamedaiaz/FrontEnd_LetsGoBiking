<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>Let's Go Biking - Itinéraire</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- CSS personnalisé -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/itinerary.css">
</head>

<body>

<!-- Header et Mobile Nav seront injectés par JS -->

    <!-- Page Itinéraire -->
    <main class="itinerary-page">

        <!-- Sidebar Gauche (Recherche + Steps) -->
        <aside class="search-sidebar" id="searchSidebar">

            <div class="sidebar-header">
                <h2>Calculer un itinéraire</h2>
                <button class="toggle-sidebar-btn" id="toggleSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="search-form">

                <!-- Input départ -->
                <div class="input-group">
                    <label for="originInput">
                        <i class="fas fa-map-marker-alt" style="color:#3498db;"></i> Départ
                    </label>

                    <div class="autocomplete-wrapper">
                        <input type="text" id="originInput" placeholder="Entrez une adresse de départ..." autocomplete="off">
                        <ul class="autocomplete-results" id="origin-results"></ul>
                    </div>
                </div>

                <!-- Input destination -->
                <div class="input-group">
                    <label for="destinationInput">
                        <i class="fas fa-map-marker-alt" style="color:#e74c3c;"></i> Arrivée
                    </label>

                    <div class="autocomplete-wrapper">
                        <input type="text" id="destinationInput" placeholder="Entrez une adresse d'arrivée..." autocomplete="off">
                        <ul class="autocomplete-results" id="destination-results"></ul>
                    </div>
                </div>

                <!-- Bouton calcul -->
                <button class="calculate-btn" id="calculateBtn">
                    <i class="fas fa-route"></i> Calculer l'itinéraire
                </button>
            </div>

            <!-- Résultats -->
            <div class="results-container" id="resultsContainer" style="display:none;">

                <div class="results-header">
                    <h3>Résultats</h3>
                </div>

                <!-- Résumé -->
                <div class="summary" id="summary"></div>

                <!-- Instructions -->
                <div class="instructions" id="instructions">
                    <h4><i class="fas fa-list"></i> Instructions</h4>
                    <div id="steps"></div>
                </div>
            </div>

            <!-- Chargement -->
            <div class="loading" id="loading" style="display:none;">
                <div class="spinner"></div>
                <p>Calcul en cours...</p>
            </div>

            <!-- Erreur -->
            <div class="error-message" id="errorMessage" style="display:none;">
                <i class="fas fa-exclamation-triangle"></i>
                <p id="errorText"></p>
            </div>

        </aside>

        <!-- Carte -->
        <div class="map-container">
            <div id="map"></div>
            
            <button class="floating-btn" id="openSidebar">
                <i class="fas fa-bars"></i>
            </button>

            <div class="map-legend">
                <h4>Légende</h4>
                <div class="legend-item">
                    <div class="legend-line bike"></div>
                    <span><i class="fas fa-bicycle"></i> Trajet à vélo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-line walk"></div>
                    <span><i class="fas fa-walking"></i> Trajet à pied</span>
                </div>
            </div>
        </div>

    </main>

    <!-- Panneau de notifications -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <div class="notifications-actions">
                <button class="mark-all-read-btn" id="markAllReadBtn" title="Tout marquer comme lu">
                    <i class="fas fa-check-double"></i>
                </button>
                <button class="close-notifications-btn" id="closeNotificationsBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="notifications-body" id="notificationsBody">
            <div class="no-notifications">
                <i class="fas fa-bell-slash"></i>
                <p>Aucune notification</p>
            </div>
        </div>
    </div>

    <!-- Bouton pour ouvrir les notifications -->
    <button class="notifications-toggle-btn" id="notificationsToggleBtn">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificationBadge">0</span>
    </button>

    <div class="overlay"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay">
        <div class="bike-loader">
            <svg class="bike-svg" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg">
                <!-- Roue arrière -->
                <g class="wheel-back">
                    <circle cx="40" cy="70" r="18" fill="none" stroke="#2563EB" stroke-width="2.5"/>
                    <line x1="40" y1="52" x2="40" y2="88" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="22" y1="70" x2="58" y2="70" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="27" y1="57" x2="53" y2="83" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="27" y1="83" x2="53" y2="57" stroke="#2563EB" stroke-width="1.5"/>
                    <circle cx="40" cy="70" r="4" fill="#2563EB"/>
                </g>
                
                <!-- Roue avant -->
                <g class="wheel-front">
                    <circle cx="140" cy="70" r="18" fill="none" stroke="#2563EB" stroke-width="2.5"/>
                    <line x1="140" y1="52" x2="140" y2="88" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="122" y1="70" x2="158" y2="70" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="127" y1="57" x2="153" y2="83" stroke="#2563EB" stroke-width="1.5"/>
                    <line x1="127" y1="83" x2="153" y2="57" stroke="#2563EB" stroke-width="1.5"/>
                    <circle cx="140" cy="70" r="4" fill="#2563EB"/>
                </g>
                
                <!-- Cadre du vélo -->
                <g class="bike-frame">
                    <!-- Triangle principal -->
                    <path d="M 40 70 L 90 35 L 140 70 L 90 70 L 40 70" fill="none" stroke="#2563EB" stroke-width="3" stroke-linejoin="round"/>
                    <!-- Guidon -->
                    <path d="M 140 70 L 150 50 L 160 48" fill="none" stroke="#2563EB" stroke-width="2.5" stroke-linecap="round"/>
                    <!-- Selle -->
                    <path d="M 90 35 L 85 28" stroke="#2563EB" stroke-width="2.5" stroke-linecap="round"/>
                    <ellipse cx="85" cy="25" rx="8" ry="3" fill="#2563EB"/>
                    <!-- Pédalier -->
                    <circle cx="90" cy="70" r="6" fill="none" stroke="#2563EB" stroke-width="2"/>
                    <line x1="90" y1="64" x2="90" y2="76" stroke="#2563EB" stroke-width="2"/>
                </g>
            </svg>
            <p class="loading-text">Calcul de l'itinéraire...</p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Module Principal -->
    <script type="module" src="../js/pages/itinerary.js"></script>

</body>
</html>
